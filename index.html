<!DOCTYPE html>
<html>
<head>
  <title>CPS Tester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #121212;
      --surface: #1e1e1e;
      --primary: #00ffcc;
      --on-surface: #ffffff;
      --secondary: #333333;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: var(--bg);
      color: var(--on-surface);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      min-height: 100vh;
      padding: 20px;
    }

    h1 {
      font-size: 2.4em;
      margin: 10px 0 20px;
      color: var(--primary);
    }

    #leaderboard {
      background: var(--surface);
      border-radius: 16px;
      padding: 16px;
      text-align: center;
      margin-bottom: 20px;
      width: 100%;
      max-width: 400px;
      border: 2px solid var(--primary);
    }

    #clickArea {
      width: 280px;
      height: 280px;
      background: var(--secondary);
      border: none;
      border-radius: 28px;
      font-size: 2.2em;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 4px 10px rgba(0, 255, 204, 0.2);
      margin: 10px 0;
      transition: 0.2s ease;
    }

    #clickArea:hover {
      background: #444;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }

    button {
      padding: 10px 18px;
      font-size: 1em;
      background: var(--primary);
      color: #000;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: 0.2s ease;
    }

    button:hover {
      background: #33ffd1;
    }

    #result {
      margin-top: 20px;
      font-size: 1.2em;
      color: #00ffaa;
      text-align: center;
    }

    dialog {
      border: none;
      border-radius: 16px;
      padding: 20px;
      background: var(--surface);
      color: var(--on-surface);
      box-shadow: 0 0 20px rgba(0,255,204,0.4);
      text-align: center;
    }

    dialog input {
      padding: 10px;
      width: 60px;
      font-size: 1.2em;
      border: 2px solid var(--primary);
      border-radius: 8px;
      background: #000;
      color: var(--primary);
      text-align: center;
    }

    @media (max-width: 400px) {
      #clickArea {
        width: 200px;
        height: 200px;
        font-size: 1.5em;
      }
    }
  </style>
</head>
<body>

  <h1>Click Speed Tester</h1>

  <div id="leaderboard">
    <strong>üèÜ Highest CPS:</strong> <span id="highCPS">0.00</span><br>
    <strong>üìú History:</strong>
    <ul id="history" style="padding-left: 15px; margin: 10px 0 0;"></ul>
  </div>

  <div id="clickArea">Click Me</div>
  <div id="result"></div>

  <div class="buttons">
    <button onclick="startGame(5)">5 Seconds</button>
    <button onclick="startGame(2)">2 Seconds</button>
    <button onclick="showCustomDialog()">Custom</button>
    <button onclick="resetGame()">Reset</button>
    <button onclick="shareScore()">Share</button>
  </div>

  <dialog id="customDialog">
    <form method="dialog" onsubmit="startCustom(event)">
      <p>Enter time (1‚Äì25 seconds):</p>
      <input type="number" id="customTime" min="1" max="25" required />
      <div style="margin-top:10px;">
        <button type="submit">Start</button>
        <button onclick="closeDialog()">Cancel</button>
      </div>
    </form>
  </dialog>

  <script>
    let clicks = 0, started = false, timer, timeLimit = 5;
    let lastCPS = 0;
    const clickArea = document.getElementById('clickArea');
    const result = document.getElementById('result');
    const dialog = document.getElementById('customDialog');
    const highCPSDisplay = document.getElementById('highCPS');
    const historyList = document.getElementById('history');

    clickArea.onclick = () => {
      if (started) {
        clicks++;
        clickArea.innerText = clicks;
      }
    };

    function startGame(seconds) {
      if (started) return;
      timeLimit = seconds;
      clicks = 0;
      started = true;
      clickArea.innerText = "0";
      result.innerText = `Time left: ${timeLimit}s`;

      let timeLeft = timeLimit;
      timer = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(timer);
          started = false;
          lastCPS = (clicks / timeLimit).toFixed(2);
          result.innerHTML = `
            Test Complete!<br>
            Total Clicks: <b>${clicks}</b><br>
            Time: <b>${timeLimit}s</b><br>
            CPS: <b>${lastCPS}</b>
          `;
          clickArea.innerText = "Click Me";
          saveCPS(lastCPS);
        } else {
          result.innerText = `Time left: ${timeLeft}s`;
        }
      }, 1000);
    }

    function resetGame() {
      clearInterval(timer);
      clicks = 0;
      started = false;
      result.innerText = "";
      clickArea.innerText = "Click Me";
    }

    function showCustomDialog() {
      dialog.showModal();
    }

    function closeDialog() {
      dialog.close();
    }

    function startCustom(e) {
      e.preventDefault();
      let value = parseInt(document.getElementById("customTime").value);
      if (value >= 1 && value <= 25) {
        dialog.close();
        startGame(value);
      } else {
        alert("Enter a number between 1 and 25.");
      }
    }

    function saveCPS(cps) {
      let history = JSON.parse(localStorage.getItem("cpsHistory") || "[]");
      history.unshift(parseFloat(cps));
      history = history.slice(0, 5);
      localStorage.setItem("cpsHistory", JSON.stringify(history));
      localStorage.setItem("cpsHigh", Math.max(...history).toFixed(2));
      showHistory();
    }

    function showHistory() {
      const history = JSON.parse(localStorage.getItem("cpsHistory") || "[]");
      const high = localStorage.getItem("cpsHigh") || "0.00";

      highCPSDisplay.innerText = high;
      historyList.innerHTML = history.map(cps => `<li>${cps} CPS</li>`).join('');
    }

    function shareScore() {
      if (!lastCPS) return alert("Finish a test first!");
      const text = `üî• My CPS is ${lastCPS} on this cool tester: ${location.href}`;
      if (navigator.share) {
        navigator.share({ text });
      } else {
        navigator.clipboard.writeText(text);
        alert("Copied to clipboard!");
      }
    }

    // Load leaderboard
    showHistory();

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>